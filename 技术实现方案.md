# MarketNiche 技术实现方案

## 一、技术架构设计

### 1.1 技术栈选择

#### 后端技术栈
- **框架**: FastAPI (Python) - 高性能、异步支持、自动API文档
- **数据库**: 
  - PostgreSQL - 存储结构化数据（产品、ASIN、关键词等）
  - Redis - 缓存热点数据、任务队列
- **数据采集**: 
  - Scrapy / Playwright - 网页爬虫框架
  - 代理池管理 - 轮换IP，控制频率
- **任务调度**: Celery + Redis - 异步任务处理
- **数据分析**: Pandas, NumPy - 数据处理和计算

#### 前端技术栈
- **框架**: React + TypeScript - 现代化UI框架
- **UI组件库**: Ant Design / Material-UI - 快速构建界面
- **状态管理**: Redux Toolkit / Zustand
- **图表库**: ECharts / Recharts - 数据可视化
- **构建工具**: Vite - 快速开发构建

#### 基础设施
- **部署**: Docker + Docker Compose
- **Web服务器**: Nginx - 反向代理和静态资源
- **监控**: Prometheus + Grafana (可选)

### 1.2 系统架构图

```
┌─────────────────┐
│   前端 (React)   │
│   - 市场分析器   │
│   - 产品数据库   │
│   - ASIN查询    │
│   - 关键词研究   │
└────────┬────────┘
         │ HTTP/WebSocket
┌────────▼────────┐
│  后端 (FastAPI)  │
│  - RESTful API  │
│  - 业务逻辑     │
│  - 数据聚合     │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌──▼────┐
│PostgreSQL│ │ Redis │
│ 主数据库  │ │ 缓存  │
└─────────┘ └───────┘
         │
┌────────▼────────┐
│  数据采集层      │
│  - Scrapy爬虫   │
│  - Celery任务   │
│  - 代理池管理   │
└─────────────────┘
```

## 二、核心功能实现路径

### 2.1 数据采集模块（Phase 1 - 最优先）

#### 2.1.1 数据源分析
- **亚马逊荷兰站公开数据**:
  - 产品列表页（搜索结果）
  - 产品详情页（ASIN页面）
  - 类目浏览页
  - 评论数据（公开部分）

#### 2.1.2 采集策略
1. **合规性措施**:
   - 控制请求频率（建议：1-2秒/请求）
   - 使用代理IP轮换
   - 设置合理的User-Agent
   - 遵守robots.txt（如果存在）
   - 仅采集公开数据，不涉及用户隐私

2. **数据采集内容**:
   - 产品基础信息（标题、价格、图片、ASIN）
   - 销售排名（BSR）
   - Review数量和星级
   - 卖家信息（FBA/FBM标识）
   - 类目信息
   - 关键词（从产品标题和描述提取）

3. **数据更新策略**:
   - 每日全量更新：价格、排名、Review数
   - 每周更新：产品基础信息
   - 每月更新：关键词搜索量（需要外部数据源）

#### 2.1.3 技术实现
```python
# 使用Scrapy框架
# 爬虫模块结构：
# - spiders/amazon_nl_spider.py
# - pipelines/data_processor.py
# - middlewares/proxy_middleware.py
# - items/product_item.py
```

### 2.2 数据存储设计（Phase 1）

#### 2.2.1 数据库表结构

**products表** (产品基础信息)
```sql
- id (主键)
- asin (唯一索引)
- title
- price (当前价格)
- currency
- image_url
- category_id
- brand
- seller_type (FBA/FBM)
- review_count
- review_rating
- bsr (Best Seller Rank)
- first_seen_date (首次发现日期)
- last_updated
```

**product_history表** (价格/排名历史)
```sql
- id
- product_id (外键)
- date
- price
- bsr
- review_count
- review_rating
```

**categories表** (类目)
```sql
- id
- name_nl (荷兰语名称)
- name_en (英语名称)
- parent_id
- path (类目路径)
```

**keywords表** (关键词)
```sql
- id
- keyword (荷兰语关键词)
- search_volume (搜索量，月度更新)
- competition_score (竞争度)
- trend (上升/下降/平稳)
- last_updated
```

**product_keywords表** (产品-关键词关联)
```sql
- product_id
- keyword_id
- relevance_score (相关性得分)
- traffic_share (流量占比，ASIN反查用)
```

**market_analysis表** (市场分析缓存)
```sql
- id
- keyword_id
- market_size (市场容量)
- total_revenue (总销售额)
- brand_concentration (品牌集中度)
- seller_concentration (卖家集中度)
- avg_reviews (平均Review数)
- price_distribution (JSON格式存储价格分布)
- trend_data (JSON格式存储趋势数据)
- analysis_date
```

### 2.3 核心功能实现（Phase 2-3）

#### 2.3.1 市场分析器 (Market Analyzer)

**实现步骤**:
1. 接收用户输入的荷兰语关键词
2. 查询该关键词下的所有产品
3. 计算市场指标:
   - 市场容量 = 所有产品预估销量之和
   - 品牌集中度 = Top 5品牌销售额 / 总销售额
   - 卖家集中度 = Top 10卖家销售额 / 总销售额
   - Review门槛 = 首页产品Review数的中位数
   - 价格分布 = 按价格区间统计产品数量
4. 返回JSON格式的分析报告

**销量预估模型**:
- 基于BSR排名和历史数据训练模型
- 使用类似产品的已知销量数据作为训练集
- 考虑类目、价格、Review数等因素

#### 2.3.2 产品数据库 (Product Database)

**实现步骤**:
1. 构建可筛选的产品列表API
2. 支持多维度筛选:
   - 价格区间
   - 预估月销量（基于BSR计算）
   - 类目（树形结构）
   - 竞争度得分（综合品牌/卖家集中度、Review数）
   - 趋势（需要历史数据对比）
3. 分页和排序功能
4. 前端展示产品卡片列表

**竞争度得分算法**:
```python
competition_score = (
    brand_concentration * 0.4 +  # 品牌集中度权重40%
    seller_concentration * 0.3 +  # 卖家集中度权重30%
    review_factor * 0.3           # Review门槛权重30%
)
# 分数越低，竞争越小
```

#### 2.3.3 ASIN深度查询 (ASIN Inspector)

**实现步骤**:
1. 查询产品基础信息
2. 查询历史数据（product_history表）
3. 生成趋势图表数据:
   - 销售趋势（30/60/90天）
   - 价格历史
   - 排名历史
   - Review增长趋势
4. 返回完整的产品分析报告

#### 2.3.4 关键词研究员 (Keyword Researcher)

**实现步骤**:
1. **关键词搜索功能**:
   - 使用亚马逊自动补全API（如果可用）
   - 或从产品标题/描述中提取相关词
   - 结合外部关键词工具API（如Google Keyword Planner的替代方案）

2. **ASIN反查功能**:
   - 分析产品标题、五点描述、类目信息
   - 提取可能的搜索关键词
   - 根据产品在该关键词下的排名估算流量占比
   - 返回关键词列表及流量占比

## 三、开发路线图

### Phase 1: 基础架构搭建（2-3周）

**Week 1-2: 项目初始化**
- [ ] 创建项目结构（前后端分离）
- [ ] 配置开发环境（Docker Compose）
- [ ] 搭建数据库（PostgreSQL + Redis）
- [ ] 创建FastAPI基础框架
- [ ] 创建React前端项目骨架

**Week 3: 数据采集基础**
- [ ] 实现基础爬虫框架（Scrapy）
- [ ] 配置代理池和请求控制
- [ ] 实现产品列表页爬虫
- [ ] 实现产品详情页爬虫
- [ ] 数据清洗和存储管道

### Phase 2: 核心功能开发（4-6周）

**Week 4-5: 数据采集完善**
- [ ] 完善爬虫覆盖范围（多个类目）
- [ ] 实现增量更新机制
- [ ] 实现历史数据采集
- [ ] 数据质量验证和监控

**Week 6-7: 后端API开发**
- [ ] 实现产品数据库API（筛选、分页）
- [ ] 实现ASIN查询API
- [ ] 实现市场分析API（基础版本）
- [ ] 实现关键词搜索API（基础版本）

**Week 8-9: 销量预估模型**
- [ ] 收集训练数据
- [ ] 开发BSR到销量的转换模型
- [ ] 模型训练和验证
- [ ] 集成到API中

### Phase 3: 前端开发（3-4周）

**Week 10-11: 核心页面开发**
- [ ] 市场分析器页面
- [ ] 产品数据库页面（带筛选）
- [ ] ASIN查询详情页
- [ ] 关键词研究页面

**Week 12-13: 数据可视化**
- [ ] 集成图表库
- [ ] 实现趋势图表
- [ ] 实现价格分布图表
- [ ] 优化用户体验

### Phase 4: 优化和测试（2-3周）

**Week 14-15: 性能优化**
- [ ] API响应时间优化
- [ ] 数据库查询优化（索引）
- [ ] Redis缓存策略
- [ ] 前端代码分割和懒加载

**Week 16: 测试和部署**
- [ ] 单元测试
- [ ] 集成测试
- [ ] 部署到生产环境
- [ ] 监控和日志系统

## 四、关键技术难点和解决方案

### 4.1 销量预估准确性

**挑战**: 亚马逊不公开真实销量，只能通过BSR估算

**解决方案**:
1. **数据收集**: 
   - 通过长期监控，收集BSR变化和Review增长数据
   - 利用Review增长速率反推销量（假设Review率）
   
2. **模型训练**:
   - 使用已知数据点（如某些产品公开的销售数据）
   - 训练BSR到销量的映射模型
   - 考虑类目、价格、季节性因素

3. **持续优化**:
   - 定期校准模型
   - 收集用户反馈，调整预估算法

### 4.2 关键词搜索量获取

**挑战**: 亚马逊不提供关键词搜索量数据

**解决方案**:
1. **短期方案**:
   - 使用Google Keyword Planner（需要API或手动）
   - 使用第三方关键词工具API（如Ahrefs、SEMrush的API）
   - 基于产品排名和类目估算相对搜索量

2. **长期方案**:
   - 建立自己的搜索量数据库
   - 通过监控产品排名变化推断关键词热度
   - 结合外部数据源（Google Trends等）

### 4.3 数据采集合规性

**挑战**: 避免被亚马逊封禁，遵守法律法规

**解决方案**:
1. **技术措施**:
   - 控制请求频率（1-2秒/请求）
   - 使用住宅代理IP轮换
   - 模拟真实浏览器行为（Playwright）
   - 设置合理的请求头

2. **法律合规**:
   - 仅采集公开数据
   - 遵守robots.txt
   - 不采集用户隐私数据
   - 考虑使用官方API（如果有）

3. **风险控制**:
   - 实现错误处理和重试机制
   - 监控采集成功率
   - 准备备用数据源

### 4.4 数据更新频率和成本

**挑战**: 平衡数据新鲜度和采集成本

**解决方案**:
1. **分层更新策略**:
   - 热门产品：每日更新
   - 普通产品：每周更新
   - 冷门产品：每月更新

2. **增量更新**:
   - 只更新变化的数据
   - 使用变更检测机制

3. **缓存策略**:
   - 热点数据缓存
   - 减少重复计算

## 五、MVP功能优先级

### P0 (必须有，否则产品无法使用)
1. ✅ 产品数据库基础筛选功能
2. ✅ ASIN基础查询（当前数据）
3. ✅ 市场分析器基础版本（基于现有数据）

### P1 (重要，提升用户体验)
1. ✅ 销量预估模型（基础版本）
2. ✅ 历史数据展示（价格、排名趋势）
3. ✅ 关键词搜索（基础版本）

### P2 (可以后续迭代)
1. ⏳ ASIN反查关键词
2. ⏳ 趋势分析（需要6个月历史数据）
3. ⏳ 高级筛选和排序

## 六、技术风险和应对

### 6.1 数据采集风险
- **风险**: 亚马逊反爬虫机制升级
- **应对**: 多数据源备份，考虑付费数据API

### 6.2 数据准确性风险
- **风险**: 销量预估不准确，影响用户信任
- **应对**: 明确标注为"预估"，提供置信区间

### 6.3 性能风险
- **风险**: 数据量大，查询慢
- **应对**: 数据库索引优化，Redis缓存，分页加载

## 七、推荐的技术资源

### 学习资源
- FastAPI官方文档: https://fastapi.tiangolo.com/
- Scrapy文档: https://docs.scrapy.org/
- React官方文档: https://react.dev/

### 工具和库
- **爬虫**: Scrapy, Playwright, Selenium
- **代理服务**: Bright Data, Smartproxy (付费) 或自建代理池
- **数据分析**: Pandas, NumPy, Scikit-learn
- **API文档**: Swagger/OpenAPI (FastAPI自动生成)

## 八、下一步行动

1. **立即开始**: 搭建项目基础架构
2. **第一周目标**: 完成数据采集原型，能够采集荷兰站产品数据
3. **第一个月目标**: 完成MVP核心功能，能够展示产品列表和基础分析

---

**建议**: 先从数据采集开始，因为这是整个产品的基础。可以先手动验证数据采集的可行性，再逐步完善系统。

